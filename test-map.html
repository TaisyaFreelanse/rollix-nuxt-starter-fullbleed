<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç API</title>
    <script src="https://api-maps.yandex.ru/3.0/?apikey=51d550e0-cf8f-4247-bae5-dfd32b51048d&lang=ru_RU" type="text/javascript"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .info { color: #60a5fa; }
        #map { width: 100%; height: 400px; margin: 20px 0; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #2563eb; }
        input { padding: 8px; width: 300px; margin: 5px; border-radius: 5px; border: 1px solid #444; background: #333; color: #fff; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç API</h1>
    
    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ API</h2>
        <div id="api-status">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
    </div>

    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç –ì–µ–æ–∫–æ–¥–µ—Ä–∞</h2>
        <input type="text" id="address-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å)" value="–ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å">
        <button onclick="testGeocoder()">–ù–∞–π—Ç–∏ –∞–¥—Ä–µ—Å</button>
        <div id="geocoder-result"></div>
    </div>

    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞</h2>
        <button onclick="testReverseGeocoder()">–ü–æ–ª—É—á–∏—Ç—å –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º (55.7558, 37.6173)</button>
        <div id="reverse-geocoder-result"></div>
    </div>

    <div class="test-section">
        <h2>4. –¢–µ—Å—Ç –∫–∞—Ä—Ç—ã</h2>
        <button onclick="initMap()">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É</button>
        <div id="map-status"></div>
        <div id="map"></div>
    </div>

    <div class="test-section">
        <h2>üìä –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç</h2>
        <div id="final-report"></div>
    </div>

    <script>
        const results = {
            apiLoaded: false,
            geocoder: false,
            reverseGeocoder: false,
            map: false
        };

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ API
        function checkAPI() {
            const statusDiv = document.getElementById('api-status');
            
            if (typeof ymaps3 !== 'undefined') {
                statusDiv.innerHTML = '<span class="success">‚úÖ API –∑–∞–≥—Ä—É–∂–µ–Ω (ymaps3 –¥–æ—Å—Ç—É–ø–µ–Ω)</span>';
                results.apiLoaded = true;
                
                if (ymaps3.ready) {
                    ymaps3.ready.then(() => {
                        statusDiv.innerHTML += '<br><span class="success">‚úÖ API –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</span>';
                        updateFinalReport();
                    });
                }
            } else {
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏
                setTimeout(() => {
                    if (typeof ymaps3 !== 'undefined') {
                        checkAPI();
                    } else {
                        statusDiv.innerHTML = '<span class="error">‚ùå API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏.</span>';
                        updateFinalReport();
                    }
                }, 1000);
            }
        }

        // –¢–µ—Å—Ç –≥–µ–æ–∫–æ–¥–µ—Ä–∞
        async function testGeocoder() {
            const input = document.getElementById('address-input').value;
            const resultDiv = document.getElementById('geocoder-result');
            resultDiv.innerHTML = '<span class="info">‚è≥ –ü–æ–∏—Å–∫...</span>';

            try {
                const encoded = encodeURIComponent(input);
                const url = `https://geocode-maps.yandex.ru/1.x/?apikey=51d550e0-cf8f-4247-bae5-dfd32b51048d&geocode=${encoded}&format=json&results=1`;
                
                const response = await fetch(url);
                const data = await response.json();
                const feature = data.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject;

                if (feature) {
                    const [lng, lat] = feature.Point.pos.split(' ').map(Number);
                    const address = feature.metaDataProperty?.GeocoderMetaData?.text;
                    resultDiv.innerHTML = `
                        <span class="success">‚úÖ –ê–¥—Ä–µ—Å –Ω–∞–π–¥–µ–Ω!</span><br>
                        <strong>–ê–¥—Ä–µ—Å:</strong> ${address}<br>
                        <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> ${lat.toFixed(6)}, ${lng.toFixed(6)}
                    `;
                    results.geocoder = true;
                } else {
                    resultDiv.innerHTML = '<span class="error">‚ùå –ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω</span>';
                    results.geocoder = false;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
                results.geocoder = false;
            }
            updateFinalReport();
        }

        // –¢–µ—Å—Ç –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞
        async function testReverseGeocoder() {
            const resultDiv = document.getElementById('reverse-geocoder-result');
            resultDiv.innerHTML = '<span class="info">‚è≥ –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞...</span>';

            try {
                const url = `https://geocode-maps.yandex.ru/1.x/?apikey=51d550e0-cf8f-4247-bae5-dfd32b51048d&geocode=37.6173,55.7558&format=json&results=1`;
                
                const response = await fetch(url);
                const data = await response.json();
                const feature = data.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject;

                if (feature) {
                    const address = feature.metaDataProperty?.GeocoderMetaData?.text;
                    resultDiv.innerHTML = `
                        <span class="success">‚úÖ –ê–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω!</span><br>
                        <strong>–ê–¥—Ä–µ—Å:</strong> ${address}
                    `;
                    results.reverseGeocoder = true;
                } else {
                    resultDiv.innerHTML = '<span class="error">‚ùå –ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω</span>';
                    results.reverseGeocoder = false;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
                results.reverseGeocoder = false;
            }
            updateFinalReport();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        async function initMap() {
            const statusDiv = document.getElementById('map-status');
            const mapDiv = document.getElementById('map');
            
            statusDiv.innerHTML = '<span class="info">‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã...</span>';

            try {
                if (typeof ymaps3 === 'undefined') {
                    throw new Error('ymaps3 –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }

                await ymaps3.ready;

                const { YMap, YMapDefaultSchemeLayer } = ymaps3;

                if (!YMap || !YMapDefaultSchemeLayer) {
                    throw new Error('–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞—Ä—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                }

                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                mapDiv.innerHTML = '';

                const map = new YMap(mapDiv, {
                    location: {
                        center: [37.6173, 55.7558], // –ú–æ—Å–∫–≤–∞ [lng, lat]
                        zoom: 10
                    }
                });

                map.addChild(new YMapDefaultSchemeLayer({}));

                statusDiv.innerHTML = '<span class="success">‚úÖ –ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!</span>';
                results.map = true;

                // –¢–µ—Å—Ç –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
                map.on('click', async (event) => {
                    const [lng, lat] = event.coordinates;
                    statusDiv.innerHTML += `<br><span class="info">üìç –ö–ª–∏–∫: ${lat.toFixed(6)}, ${lng.toFixed(6)}</span>`;
                });

            } catch (error) {
                statusDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
                results.map = false;
            }
            updateFinalReport();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞
        function updateFinalReport() {
            const reportDiv = document.getElementById('final-report');
            const allPassed = Object.values(results).every(r => r === true);
            const passedCount = Object.values(results).filter(r => r === true).length;
            const totalCount = Object.keys(results).length;

            reportDiv.innerHTML = `
                <div>
                    <strong>–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤:</strong> ${passedCount}/${totalCount}<br>
                    <strong>API –∑–∞–≥—Ä—É–∂–µ–Ω:</strong> ${results.apiLoaded ? '‚úÖ' : '‚ùå'}<br>
                    <strong>–ì–µ–æ–∫–æ–¥–µ—Ä:</strong> ${results.geocoder ? '‚úÖ' : '‚ùå'}<br>
                    <strong>–û–±—Ä–∞—Ç–Ω—ã–π –≥–µ–æ–∫–æ–¥–∏–Ω–≥:</strong> ${results.reverseGeocoder ? '‚úÖ' : '‚ùå'}<br>
                    <strong>–ö–∞—Ä—Ç–∞:</strong> ${results.map ? '‚úÖ' : '‚ùå'}<br><br>
                    <strong style="font-size: 1.2em; color: ${allPassed ? '#4ade80' : '#f87171'}">
                        ${allPassed ? '‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!' : '‚ö†Ô∏è –ù–ï–ö–û–¢–û–†–´–ï –¢–ï–°–¢–´ –ù–ï –ü–†–û–ô–î–ï–ù–´'}
                    </strong>
                </div>
            `;
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(checkAPI, 500);
        });
    </script>
</body>
</html>

